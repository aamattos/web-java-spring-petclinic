@Library(['alm-totta-platform-library@develop', 'alm-totta-commons-library@develop', 'alm-totta-maven-library@develop']) _

import org.jenkinsci.plugins.workflow.steps.FlowInterruptedException
import pt.alm.util.pipeline.DistributionProfile
import pt.alm.dashboard.model.*
import pt.alm.nexus.NexusRepositories

try{

		//DEVELOP PIPELINE
		node('maven') {
			
			def petclinic_war_url
			
			stage("Checkout") {
				
				// Clone the project from Git, checkout the branch configured in Jenkins
				checkout scm

			}
			
			stage ('Get Latest Snapshots'){
				
				petclinic_war_url = nexus.getLatestArtifactAssetURL(NexusRepository.MAVEN_SNAPSHOTS, 
					                                                                                              "org.springframework.samples", 
																												  "petclinic", 
																												  "war")
			}
			
			stage ('Deploy in Dev'){
		
				def authToken = "petclinic-openshift-token"
				def templatePath = "openshift/petclinic.yml"
				def params =  readYaml file: "openshift/params-dev.yml"

				params.petclinic_war_url =  "${petclinic_war_url}"
				
				openshiftPipeline.applyTemplate(authToken, "alm-petclinic-dev", templatePath, params)
				
			}
			

		}
		


}catch(FlowInterruptedException exc){

	print "Flow Canceled"

}finally{

}


